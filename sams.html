<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelas Pak Mahfud</title>
    <link rel="icon" type="image/png" href="https://archive.org/download/logoms-1/logowarna.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s;
            cursor: pointer;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
        }
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s;
            cursor: pointer;
        }
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 1rem;
        }
        .modal-content {
            background: white;
            border-radius: 1rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
        }
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            color: white;
            font-weight: 600;
            z-index: 100;
        }
        .notification.success { background: #10b981; }
        .notification.error { background: #ef4444; }
        .notification.info { background: #3b82f6; }
        .card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        .progress-bar {
            background: #e5e7eb;
            border-radius: 0.5rem;
            height: 0.5rem;
            overflow: hidden;
        }
        .progress-fill {
            background: linear-gradient(90deg, #10b981, #059669);
            height: 100%;
            transition: width 0.3s ease;
        }
        .file-drop-zone {
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        .file-drop-zone:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }
        .file-drop-zone.dragover {
            border-color: #10b981;
            background: #f0fdf4;
        }
        @media (max-width: 640px) {
            .btn-primary, .btn-success {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
            .admin-buttons {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
            .admin-buttons button {
                width: 100%;
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-20 h-20 mx-auto mb-4">
                    <img src="https://archive.org/download/logoms-1/logowarna.png" alt="Logo" class="w-full h-full object-contain">
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">Kelas Pak Mahfud</h1>
                <p class="text-gray-600">Student Assignment Management System</p>
            </div>
            
            <form onsubmit="handleLogin(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input type="text" id="loginUsername" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Masukkan username" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="loginPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Masukkan password" required>
                    </div>
                </div>
                
                <button type="submit" class="w-full btn-primary mt-6">Masuk</button>
            </form>
            
            <div class="mt-6 text-center text-sm">
                <a href="https://mr-emes.github.io/exams/nomorinduk.html" 
                   target="_blank" 
                   class="text-blue-600 hover:underline">
                    Lupa NIS?
                </a>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10">
                            <img src="https://archive.org/download/logoms-1/logoputih.png" alt="Logo" class="w-full h-full object-contain">
                        </div>
                        <div>
                            <h1 class="text-xl font-bold">Kelas Pak Mahfud</h1>
                            <p class="text-xs opacity-80">Sistem manajemen Tugas Siswa</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="showEditProfileModal()" class="p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-all">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </button>
                        <button onclick="logout()" class="p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-all">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- User Info (Below Header) -->
        <div class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                    <div class="flex items-center space-x-4 mb-3 md:mb-0">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-lg font-bold text-blue-600" id="userAvatar">U</span>
                        </div>
                        <div>
                            <h2 class="text-lg font-bold text-gray-800" id="userName">User</h2>
                            <p class="text-gray-600" id="userRole">Role</p>
                            <p class="text-sm text-gray-500" id="userInfo">Info</p>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600">
                        <div>Login: <span id="loginTime">-</span></div>
                        <div id="quickStats">0 tugas â€¢ 0 pengumpulan</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-6">
            <!-- Admin View -->
            <div id="adminView" class="hidden">
                <div class="mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Dashboard Admin</h2>
                        <p class="text-gray-600">Kelola tugas dan pantau progress siswa</p>
                    </div>
                    <div class="admin-buttons flex flex-wrap gap-2 mt-4">
                        <button onclick="showCreateAssignmentModal()" class="btn-success flex items-center">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            Buat Tugas
                        </button>
                        <button onclick="showImportStudentsModal()" class="btn-primary flex items-center">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            Import Siswa
                        </button>
                        <button onclick="showBulkGradeModal()" class="btn-primary flex items-center">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Nilai Massal
                        </button>
                        <button onclick="exportGrades()" class="btn-primary flex items-center">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Ekspor Nilai
                        </button>
                        <button onclick="showSendRemindersModal()" class="btn-primary flex items-center">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                            </svg>
                            Kirim Pengingat
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Total Tugas</p>
                                <p class="text-2xl font-bold text-blue-600" id="adminTotalAssignments">0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Menunggu Review</p>
                                <p class="text-2xl font-bold text-orange-600" id="adminPendingReview">0</p>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Sudah Dinilai</p>
                                <p class="text-2xl font-bold text-green-600" id="adminGraded">0</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Total Siswa</p>
                                <p class="text-2xl font-bold text-purple-600" id="adminTotalStudents">0</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assignments List -->
                <div class="card">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Daftar Tugas</h3>
                    <div id="adminAssignmentsList">
                        <!-- Admin assignments will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Student View -->
            <div id="studentView" class="hidden">
                <div class="mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Dashboard Siswa</h2>
                        <p class="text-gray-600">Lihat dan kumpulkan tugas Anda</p>
                    </div>
                </div>

                <!-- Student Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Belum Selesai</p>
                                <p class="text-2xl font-bold text-orange-600" id="studentPending">0</p>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Sudah Dikumpulkan</p>
                                <p class="text-2xl font-bold text-blue-600" id="studentSubmitted">0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Rata-rata Nilai</p>
                                <p class="text-2xl font-bold text-green-600" id="studentAverage">0%</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Student Assignments -->
                <div class="card">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Tugas Saya</h3>
                    <div id="studentAssignmentsList">
                        <!-- Student assignments will be loaded here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal hidden">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Edit Profil</h3>
                <button onclick="hideEditProfileModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form onsubmit="updateProfile(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                        <input type="text" id="profileName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input type="text" id="profileUsername" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100" readonly>
                    </div>
                    <div id="studentFields" class="hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                            <select id="profileClass" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="4A">4A</option>
                                <option value="4B">4B</option>
                                <option value="5A">5A</option>
                                <option value="5B">5B</option>
                                <option value="6A">6A</option>
                                <option value="6B">6B</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password Baru (Kosongkan jika tidak ingin mengubah)</label>
                        <input type="password" id="newPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <div class="flex space-x-3 mt-6">
                    <button type="button" onclick="hideEditProfileModal()" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">Batal</button>
                    <button type="submit" class="flex-1 btn-primary">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Assignment Modal -->
    <div id="createAssignmentModal" class="modal hidden">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Buat Tugas Baru</h3>
                <button onclick="hideCreateAssignmentModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form onsubmit="createAssignment(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mata Pelajaran</label>
                        <select id="assignmentSubject" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Pilih Mata Pelajaran</option>
                            <option value="Al-Quran Hadits">Al-Quran Hadits</option>
                            <option value="Akidah Akhlak">Akidah Akhlak</option>
                            <option value="Fikih">Fikih</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Judul Tugas</label>
                        <input type="text" id="assignmentTitle" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi</label>
                        <textarea id="assignmentDescription" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" rows="3" required></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                            <select id="assignmentClass" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Pilih Kelas</option>
                                <option value="4A">4A</option>
                                <option value="4B">4B</option>
                                <option value="5A">5A</option>
                                <option value="5B">5B</option>
                                <option value="6A">6A</option>
                                <option value="6B">6B</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nilai Maksimal</label>
                            <input type="number" id="assignmentMaxScore" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="100" min="1" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Deadline</label>
                        <input type="datetime-local" id="assignmentDueDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Upload File Tugas (Opsional)</label>
                        <div class="file-drop-zone" onclick="document.getElementById('assignmentFile').click()">
                            <input type="file" id="assignmentFile" class="hidden" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                            <svg class="w-12 h-12 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="text-gray-600">Klik untuk upload file atau drag & drop</p>
                            <p class="text-xs text-gray-500 mt-1">PDF, DOC, DOCX, JPG, PNG (Max 10MB)</p>
                        </div>
                        <div id="assignmentFilePreview" class="hidden mt-2 p-2 bg-gray-50 rounded border">
                            <span id="assignmentFileName" class="text-sm text-gray-700"></span>
                            <button type="button" onclick="removeAssignmentFile()" class="ml-2 text-red-600 hover:text-red-800">
                                <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3 mt-6">
                    <button type="button" onclick="hideCreateAssignmentModal()" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">Batal</button>
                    <button type="submit" class="flex-1 btn-success">Buat Tugas</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import Students Modal -->
    <div id="importStudentsModal" class="modal hidden">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Import Data Siswa</h3>
                <button onclick="hideImportStudentsModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <h4 class="font-medium text-gray-800 mb-2">Format File Excel/CSV</h4>
                    <p class="text-sm text-gray-600 mb-3">File harus memiliki kolom: NIS, Nama, Kelas</p>
                    <button onclick="downloadTemplate()" class="btn-primary text-sm">
                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Download Template
                    </button>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Upload File</label>
                    <div class="file-drop-zone" onclick="document.getElementById('importFile').click()">
                        <input type="file" id="importFile" class="hidden" accept=".csv,.xlsx,.xls">
                        <svg class="w-12 h-12 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        <p class="text-gray-600">Klik untuk upload file Excel/CSV</p>
                        <p class="text-xs text-gray-500 mt-1">CSV, XLSX (Max 5MB)</p>
                    </div>
                    <div id="importFilePreview" class="hidden mt-2 p-2 bg-gray-50 rounded border">
                        <span id="importFileName" class="text-sm text-gray-700"></span>
                        <button type="button" onclick="removeImportFile()" class="ml-2 text-red-600 hover:text-red-800">
                            <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="hideImportStudentsModal()" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">Batal</button>
                <button onclick="processImport()" class="flex-1 btn-primary">Import Data</button>
            </div>
        </div>
    </div>

    <!-- Submit Assignment Modal -->
    <div id="submitAssignmentModal" class="modal hidden">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Kumpulkan Tugas</h3>
                <button onclick="hideSubmitAssignmentModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="mb-4">
                <h4 class="font-medium text-gray-800" id="submitAssignmentTitle">Judul Tugas</h4>
                <p class="text-sm text-gray-600" id="submitAssignmentSubject">Mata Pelajaran</p>
                <p class="text-sm text-gray-600" id="submitAssignmentDueDate">Deadline: -</p>
            </div>
            
            <form onsubmit="submitAssignment(event)">
                <input type="hidden" id="submitAssignmentId">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Upload Jawaban</label>
                    <div class="file-drop-zone" onclick="document.getElementById('submissionFile').click()">
                        <input type="file" id="submissionFile" class="hidden" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                        <svg class="w-12 h-12 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        <p class="text-gray-600">Klik untuk upload file atau drag & drop</p>
                        <p class="text-xs text-gray-500 mt-1">PDF, DOC, DOCX, JPG, PNG (Max 10MB)</p>
                    </div>
                    <div id="submissionFilePreview" class="hidden mt-2 p-2 bg-gray-50 rounded border">
                        <span id="submissionFileName" class="text-sm text-gray-700"></span>
                        <button type="button" onclick="removeSubmissionFile()" class="ml-2 text-red-600 hover:text-red-800">
                            <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="flex space-x-3 mt-6">
                    <button type="button" onclick="hideSubmitAssignmentModal()" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">Batal</button>
                    <button type="submit" class="flex-1 btn-success">Kumpulkan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Grade Assignment Modal -->
    <div id="gradeAssignmentModal" class="modal hidden">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Nilai Tugas</h3>
                <button onclick="hideGradeAssignmentModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="mb-4">
                <h4 class="font-medium text-gray-800" id="gradeAssignmentTitle">Judul Tugas</h4>
                <p class="text-sm text-gray-600" id="gradeAssignmentStudent">Siswa: -</p>
                <p class="text-sm text-gray-600" id="gradeAssignmentSubject">Mata Pelajaran: -</p>
                <p class="text-sm text-gray-600" id="gradeAssignmentDueDate">Deadline: -</p>
                <div id="gradeAssignmentSubmission" class="mt-2">
                    <p class="text-sm font-medium text-gray-700">File Jawaban:</p>
                    <a href="#" id="gradeAssignmentFileLink" target="_blank" class="text-sm text-blue-600 hover:underline">Lihat file</a>
                </div>
            </div>
            
            <form onsubmit="gradeAssignment(event)">
                <input type="hidden" id="gradeAssignmentId">
                <input type="hidden" id="gradeStudentId">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nilai (0-<span id="maxScore">100</span>)</label>
                    <input type="number" id="assignmentScore" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" min="0" max="100" required>
                </div>
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Komentar (Opsional)</label>
                    <textarea id="assignmentFeedback" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
                </div>
                
                <div class="flex space-x-3 mt-6">
                    <button type="button" onclick="hideGradeAssignmentModal()" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">Batal</button>
                    <button type="submit" class="flex-1 btn-success">Simpan Nilai</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Submissions Modal -->
    <div id="viewSubmissionsModal" class="modal hidden">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Daftar Pengumpulan</h3>
                <button onclick="hideViewSubmissionsModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="mb-4">
                <h4 class="font-medium text-gray-800" id="submissionsAssignmentTitle">Judul Tugas</h4>
                <p class="text-sm text-gray-600" id="submissionsAssignmentSubject">Mata Pelajaran: -</p>
                <p class="text-sm text-gray-600" id="submissionsAssignmentDueDate">Deadline: -</p>
                <div class="flex items-center mt-2">
                    <span class="text-sm font-medium text-gray-700 mr-2">Status:</span>
                    <span id="submissionsStatus" class="text-sm px-2 py-1 rounded-full bg-blue-100 text-blue-800">-</span>
                </div>
            </div>
            
            <div class="max-h-96 overflow-y-auto">
                <table class="w-full text-sm text-left text-gray-700">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                        <tr>
                            <th class="px-3 py-2">Nama Siswa</th>
                            <th class="px-3 py-2">Kelas</th>
                            <th class="px-3 py-2">Status</th>
                            <th class="px-3 py-2">Nilai</th>
                            <th class="px-3 py-2">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="submissionsList">
                        <!-- Submissions will be listed here -->
                    </tbody>
                </table>
            </div>
            
            <div class="mt-4">
                <button onclick="hideViewSubmissionsModal()" class="w-full px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification hidden"></div>

    <script>
        // Global variables
        let currentUser = null;
        let assignments = [];
        let submissions = [];
        let students = [];
        let teachers = [];
        
        // Initialize the app
        function initApp() {
            // Load data from localStorage
            loadData();
            
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            }
        }
        
        // Load data from localStorage
        function loadData() {
            const savedAssignments = localStorage.getItem('assignments');
            const savedSubmissions = localStorage.getItem('submissions');
            const savedStudents = localStorage.getItem('students');
            const savedTeachers = localStorage.getItem('teachers');
            
            assignments = savedAssignments ? JSON.parse(savedAssignments) : [];
            submissions = savedSubmissions ? JSON.parse(savedSubmissions) : [];
            students = savedStudents ? JSON.parse(savedStudents) : [];
            teachers = savedTeachers ? JSON.parse(savedTeachers) : [];
            
            // If no data exists, initialize with sample data
            if (students.length === 0) {
                initializeSampleData();
            }
        }
        
        // Initialize sample data
        function initializeSampleData() {
            // Sample students
            students = [
                { id: '1001', username: 'siswa1', password: 'password', name: 'Ahmad Rizki', class: '4A' },
                { id: '1002', username: 'siswa2', password: 'password', name: 'Siti Nurhaliza', class: '4A' },
                { id: '1003', username: 'siswa3', password: 'password', name: 'Budi Santoso', class: '4B' },
                { id: '1004', username: 'siswa4', password: 'password', name: 'Dewi Lestari', class: '4B' },
                { id: '1005', username: 'siswa5', password: 'password', name: 'Rudi Hermawan', class: '5A' },
                { id: '1006', username: 'siswa6', password: 'password', name: 'Maya Sari', class: '5A' },
                { id: '1007', username: 'siswa7', password: 'password', name: 'Fajar Pratama', class: '5B' },
                { id: '1008', username: 'siswa8', password: 'password', name: 'Indah Permatasari', class: '5B' },
                { id: '1009', username: 'siswa9', password: 'password', name: 'Hendra Gunawan', class: '6A' },
                { id: '1010', username: 'siswa10', password: 'password', name: 'Rina Wulandari', class: '6A' },
                { id: '1011', username: 'siswa11', password: 'password', name: 'Joko Susilo', class: '6B' },
                { id: '1012', username: 'siswa12', password: 'password', name: 'Lia Amelia', class: '6B' }
            ];
            
            // Sample teachers
            teachers = [
                { id: '2001', username: 'guru1', password: 'password', name: 'Pak Mahfud', subject: 'Al-Quran Hadits' },
                { id: '2002', username: 'guru2', password: 'password', name: 'Bu Siti', subject: 'Akidah Akhlak' },
                { id: '2003', username: 'guru3', password: 'password', name: 'Pak Ahmad', subject: 'Fikih' }
            ];
            
            // Sample admin
            const admin = { id: '3001', username: 'admin', password: 'admin', name: 'Administrator', role: 'admin' };
            teachers.push(admin);
            
            // Save to localStorage
            localStorage.setItem('students', JSON.stringify(students));
            localStorage.setItem('teachers', JSON.stringify(teachers));
        }
        
        // Handle login
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            // Check if user is a student
            const student = students.find(s => s.username === username && s.password === password);
            if (student) {
                currentUser = { ...student, role: 'student' };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMainApp();
                showNotification('Login berhasil!', 'success');
                return;
            }
            
            // Check if user is a teacher or admin
            const teacher = teachers.find(t => t.username === username && t.password === password);
            if (teacher) {
                currentUser = { ...teacher, role: teacher.role || 'teacher' };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMainApp();
                showNotification('Login berhasil!', 'success');
                return;
            }
            
            showNotification('Username atau password salah!', 'error');
        }
        
        // Show main app
        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Update user info
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0);
            document.getElementById('userName').textContent = currentUser.name;
            
            // Set login time
            const now = new Date();
            document.getElementById('loginTime').textContent = now.toLocaleString('id-ID');
            
            // Show appropriate view based on role
            if (currentUser.role === 'student') {
                document.getElementById('studentView').classList.remove('hidden');
                document.getElementById('adminView').classList.add('hidden');
                document.getElementById('userRole').textContent = 'Siswa';
                document.getElementById('userInfo').textContent = `Kelas: ${currentUser.class}`;
                document.getElementById('studentFields').classList.remove('hidden');
                
                // Load student data
                loadStudentData();
            } else {
                document.getElementById('studentView').classList.add('hidden');
                document.getElementById('adminView').classList.remove('hidden');
                
                if (currentUser.role === 'admin') {
                    document.getElementById('userRole').textContent = 'Administrator';
                    document.getElementById('userInfo').textContent = 'Sistem Manajemen';
                } else {
                    document.getElementById('userRole').textContent = 'Guru';
                    document.getElementById('userInfo').textContent = `Mata Pelajaran: ${currentUser.subject}`;
                }
                
                // Load admin data
                loadAdminData();
            }
            
            // Update quick stats
            updateQuickStats();
        }
        
        // Load student data
        function loadStudentData() {
            // Filter assignments for this student's class
            const studentAssignments = assignments.filter(a => a.class === currentUser.class);
            
            // Count stats
            const pending = studentAssignments.filter(a => {
                const submission = submissions.find(s => s.assignmentId === a.id && s.studentId === currentUser.id);
                return !submission;
            }).length;
            
            const submitted = studentAssignments.filter(a => {
                const submission = submissions.find(s => s.assignmentId === a.id && s.studentId === currentUser.id);
                return !!submission;
            }).length;
            
            // Calculate average score
            const gradedSubmissions = submissions.filter(s => 
                s.studentId === currentUser.id && s.score !== undefined
            );
            
            const average = gradedSubmissions.length > 0 
                ? Math.round(gradedSubmissions.reduce((sum, s) => sum + s.score, 0) / gradedSubmissions.length)
                : 0;
            
            // Update stats
            document.getElementById('studentPending').textContent = pending;
            document.getElementById('studentSubmitted').textContent = submitted;
            document.getElementById('studentAverage').textContent = `${average}%`;
            
            // Render assignments
            renderStudentAssignments(studentAssignments);
        }
        
        // Render student assignments
        function renderStudentAssignments(assignmentsList) {
            const container = document.getElementById('studentAssignmentsList');
            container.innerHTML = '';
            
            if (assignmentsList.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <svg class="w-12 h-12 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <p>Tidak ada tugas saat ini.</p>
                    </div>
                `;
                return;
            }
            
            // Sort assignments by due date (soonest first)
            assignmentsList.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
            
            assignmentsList.forEach(assignment => {
                const submission = submissions.find(s => 
                    s.assignmentId === assignment.id && s.studentId === currentUser.id
                );
                
                const dueDate = new Date(assignment.dueDate);
                const now = new Date();
                const isOverdue = now > dueDate;
                const status = submission ? 'submitted' : isOverdue ? 'overdue' : 'pending';
                
                let statusText, statusClass, buttonHtml;
                
                if (status === 'submitted') {
                    statusText = submission.score !== undefined 
                        ? `Dinilai: ${submission.score}/${assignment.maxScore}` 
                        : 'Sudah dikumpulkan';
                    statusClass = submission.score !== undefined 
                        ? 'bg-green-100 text-green-800' 
                        : 'bg-blue-100 text-blue-800';
                    
                    buttonHtml = `
                        <button class="p-2 text-blue-600 hover:text-blue-800" title="Lihat Detail">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                        </button>
                    `;
                } else if (status === 'overdue') {
                    statusText = 'Terlambat';
                    statusClass = 'bg-red-100 text-red-800';
                    buttonHtml = `
                        <button class="p-2 text-gray-400 cursor-not-allowed" title="Tidak dapat dikumpulkan" disabled>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                        </button>
                    `;
                } else {
                    statusText = 'Belum dikumpulkan';
                    statusClass = 'bg-yellow-100 text-yellow-800';
                    buttonHtml = `
                        <button onclick="showSubmitAssignmentModal('${assignment.id}')" class="p-2 text-blue-600 hover:text-blue-800" title="Kumpulkan Tugas">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                        </button>
                    `;
                }
                
                const assignmentElement = document.createElement('div');
                assignmentElement.className = 'border border-gray-200 rounded-lg p-4 mb-4';
                assignmentElement.innerHTML = `
                    <div class="flex flex-col md:flex-row md:items-start md:justify-between">
                        <div class="flex-1 mb-3 md:mb-0">
                            <h4 class="font-semibold text-gray-800">${assignment.title}</h4>
                            <div class="mt-2 text-sm text-gray-600">
                                <p>${assignment.subject} â€¢ ${assignment.class}</p>
                                <p>Deadline: ${formatDate(assignment.dueDate)}</p>
                                <p class="mt-1">${assignment.description}</p>
                            </div>
                        </div>
                        <div class="flex flex-col items-end">
                            <span class="text-xs px-2 py-1 rounded-full ${statusClass} mb-2">${statusText}</span>
                            <div class="flex space-x-1">
                                ${buttonHtml}
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(assignmentElement);
            });
        }
        
        // Load admin data
        function loadAdminData() {
            // Count stats
            const totalAssignments = assignments.length;
            
            const pendingReview = submissions.filter(s => s.score === undefined).length;
            const graded = submissions.filter(s => s.score !== undefined).length;
            const totalStudents = students.length;
            
            // Update stats
            document.getElementById('adminTotalAssignments').textContent = totalAssignments;
            document.getElementById('adminPendingReview').textContent = pendingReview;
            document.getElementById('adminGraded').textContent = graded;
            document.getElementById('adminTotalStudents').textContent = totalStudents;
            
            // Render assignments
            renderAdminAssignments();
        }
        
        // Render admin assignments
        function renderAdminAssignments() {
            const container = document.getElementById('adminAssignmentsList');
            container.innerHTML = '';
            
            if (assignments.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <svg class="w-12 h-12 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <p>Belum ada tugas. Buat tugas pertama Anda!</p>
                    </div>
                `;
                return;
            }
            
            // Sort assignments by creation date (newest first)
            assignments.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            assignments.forEach(assignment => {
                const dueDate = new Date(assignment.dueDate);
                const now = new Date();
                const isActive = now <= dueDate;
                
                // Count submissions for this assignment
                const assignmentSubmissions = submissions.filter(s => s.assignmentId === assignment.id);
                const submittedCount = assignmentSubmissions.length;
                const gradedCount = assignmentSubmissions.filter(s => s.score !== undefined).length;
                
                const totalStudents = students.filter(s => s.class === assignment.class).length;
                
                const assignmentElement = document.createElement('div');
                assignmentElement.className = 'border border-gray-200 rounded-lg p-4 mb-4';
                assignmentElement.innerHTML = `
                    <div class="flex flex-col md:flex-row md:items-start md:justify-between">
                        <div class="flex-1 mb-3 md:mb-0">
                            <h4 class="font-semibold text-gray-800">${assignment.title}</h4>
                            <div class="mt-2 text-sm text-gray-600">
                                <p>${assignment.subject} â€¢ ${assignment.class} â€¢ ${isActive ? 'Aktif' : 'Selesai'}</p>
                                <p>Deadline: ${formatDate(assignment.dueDate)}</p>
                                <p class="mt-1">${assignment.description}</p>
                                <div class="mt-2">
                                    <div class="flex items-center justify-between text-xs">
                                        <span>Pengumpulan: ${submittedCount}/${totalStudents}</span>
                                        <span>Dinilai: ${gradedCount}/${submittedCount}</span>
                                    </div>
                                    <div class="progress-bar mt-1">
                                        <div class="progress-fill" style="width: ${(submittedCount/totalStudents)*100}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col space-y-2">
                            <button onclick="showViewSubmissionsModal('${assignment.id}')" class="p-2 text-blue-600 hover:text-blue-800" title="Lihat Pengumpulan">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                            <button onclick="editAssignment('${assignment.id}')" class="p-2 text-yellow-600 hover:text-yellow-800" title="Edit Tugas">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="deleteAssignment('${assignment.id}')" class="p-2 text-red-600 hover:text-red-800" title="Hapus Tugas">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(assignmentElement);
            });
        }
        
        // Update quick stats
        function updateQuickStats() {
            if (currentUser.role === 'student') {
                const studentAssignments = assignments.filter(a => a.class === currentUser.class);
                const submittedCount = studentAssignments.filter(a => {
                    const submission = submissions.find(s => s.assignmentId === a.id && s.studentId === currentUser.id);
                    return !!submission;
                }).length;
                
                document.getElementById('quickStats').textContent = `${studentAssignments.length} tugas â€¢ ${submittedCount} pengumpulan`;
            } else {
                const pendingReview = submissions.filter(s => s.score === undefined).length;
                document.getElementById('quickStats').textContent = `${assignments.length} tugas â€¢ ${pendingReview} menunggu review`;
            }
        }
        
        // Show submit assignment modal
        function showSubmitAssignmentModal(assignmentId) {
            const assignment = assignments.find(a => a.id === assignmentId);
            if (!assignment) return;
            
            document.getElementById('submitAssignmentId').value = assignmentId;
            document.getElementById('submitAssignmentTitle').textContent = assignment.title;
            document.getElementById('submitAssignmentSubject').textContent = assignment.subject;
            document.getElementById('submitAssignmentDueDate').textContent = `Deadline: ${formatDate(assignment.dueDate)}`;
            
            // Reset file input
            document.getElementById('submissionFile').value = '';
            document.getElementById('submissionFilePreview').classList.add('hidden');
            
            document.getElementById('submitAssignmentModal').classList.remove('hidden');
        }
        
        // Hide submit assignment modal
        function hideSubmitAssignmentModal() {
            document.getElementById('submitAssignmentModal').classList.add('hidden');
        }
        
        // Submit assignment
        function submitAssignment(event) {
            event.preventDefault();
            
            const assignmentId = document.getElementById('submitAssignmentId').value;
            const fileInput = document.getElementById('submissionFile');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                showNotification('Harap pilih file jawaban!', 'error');
                return;
            }
            
            // In a real app, you would upload the file to a server
            // For this demo, we'll just simulate the process
            
            const file = fileInput.files[0];
            const fileName = file.name;
            
            // Create submission
            const submission = {
                id: generateId(),
                assignmentId: assignmentId,
                studentId: currentUser.id,
                fileName: fileName,
                submittedAt: new Date().toISOString(),
                score: undefined,
                feedback: ''
            };
            
            submissions.push(submission);
            localStorage.setItem('submissions', JSON.stringify(submissions));
            
            showNotification('Tugas berhasil dikumpulkan!', 'success');
            hideSubmitAssignmentModal();
            
            // Reload data
            if (currentUser.role === 'student') {
                loadStudentData();
            } else {
                loadAdminData();
            }
            
            updateQuickStats();
        }
        
        // Show create assignment modal
        function showCreateAssignmentModal() {
            // Reset form
            document.getElementById('assignmentSubject').value = '';
            document.getElementById('assignmentTitle').value = '';
            document.getElementById('assignmentDescription').value = '';
            document.getElementById('assignmentClass').value = '';
            document.getElementById('assignmentMaxScore').value = '100';
            
            // Set due date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('assignmentDueDate').value = tomorrow.toISOString().slice(0, 16);
            
            // Reset file input
            document.getElementById('assignmentFile').value = '';
            document.getElementById('assignmentFilePreview').classList.add('hidden');
            
            document.getElementById('createAssignmentModal').classList.remove('hidden');
        }
        
        // Hide create assignment modal
        function hideCreateAssignmentModal() {
            document.getElementById('createAssignmentModal').classList.add('hidden');
        }
        
        // Create assignment
        function createAssignment(event) {
            event.preventDefault();
            
            const subject = document.getElementById('assignmentSubject').value;
            const title = document.getElementById('assignmentTitle').value;
            const description = document.getElementById('assignmentDescription').value;
            const classValue = document.getElementById('assignmentClass').value;
            const maxScore = document.getElementById('assignmentMaxScore').value;
            const dueDate = document.getElementById('assignmentDueDate').value;
            
            // Create assignment object
            const assignment = {
                id: generateId(),
                subject: subject,
                title: title,
                description: description,
                class: classValue,
                maxScore: parseInt(maxScore),
                dueDate: dueDate,
                createdAt: new Date().toISOString(),
                createdBy: currentUser.id
            };
            
            // Handle file upload if any
            const fileInput = document.getElementById('assignmentFile');
            if (fileInput.files && fileInput.files.length > 0) {
                // In a real app, you would upload the file to a server
                // For this demo, we'll just store the file name
                assignment.fileName = fileInput.files[0].name;
            }
            
            assignments.push(assignment);
            localStorage.setItem('assignments', JSON.stringify(assignments));
            
            showNotification('Tugas berhasil dibuat!', 'success');
            hideCreateAssignmentModal();
            
            // Reload admin data
            loadAdminData();
            updateQuickStats();
        }
        
        // Show view submissions modal
        function showViewSubmissionsModal(assignmentId) {
            const assignment = assignments.find(a => a.id === assignmentId);
            if (!assignment) return;
            
            document.getElementById('submissionsAssignmentTitle').textContent = assignment.title;
            document.getElementById('submissionsAssignmentSubject').textContent = `Mata Pelajaran: ${assignment.subject}`;
            document.getElementById('submissionsAssignmentDueDate').textContent = `Deadline: ${formatDate(assignment.dueDate)}`;
            
            // Check assignment status
            const dueDate = new Date(assignment.dueDate);
            const now = new Date();
            const isActive = now <= dueDate;
            
            const statusElement = document.getElementById('submissionsStatus');
            statusElement.textContent = isActive ? 'Aktif' : 'Selesai';
            statusElement.className = `text-sm px-2 py-1 rounded-full ${isActive ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}`;
            
            // Get submissions for this assignment
            const assignmentSubmissions = submissions.filter(s => s.assignmentId === assignmentId);
            
            // Get students in this class
            const classStudents = students.filter(s => s.class === assignment.class);
            
            // Render submissions list
            const container = document.getElementById('submissionsList');
            container.innerHTML = '';
            
            if (classStudents.length === 0) {
                container.innerHTML = '<tr><td colspan="5" class="px-3 py-4 text-center text-gray-500">Tidak ada siswa di kelas ini.</td></tr>';
            } else {
                classStudents.forEach(student => {
                    const submission = assignmentSubmissions.find(s => s.studentId === student.id);
                    
                    let statusText, statusClass, scoreText, actionButton;
                    
                    if (submission) {
                        if (submission.score !== undefined) {
                            statusText = 'Sudah dinilai';
                            statusClass = 'bg-green-100 text-green-800';
                            scoreText = `${submission.score}/${assignment.maxScore}`;
                            actionButton = `
                                <button onclick="showGradeAssignmentModal('${assignment.id}', '${student.id}')" class="text-blue-600 hover:text-blue-800">
                                    Edit Nilai
                                </button>
                            `;
                        } else {
                            statusText = 'Belum dinilai';
                            statusClass = 'bg-yellow-100 text-yellow-800';
                            scoreText = '-';
                            actionButton = `
                                <button onclick="showGradeAssignmentModal('${assignment.id}', '${student.id}')" class="text-blue-600 hover:text-blue-800">
                                    Beri Nilai
                                </button>
                            `;
                        }
                    } else {
                        statusText = 'Belum dikumpulkan';
                        statusClass = 'bg-red-100 text-red-800';
                        scoreText = '-';
                        actionButton = '-';
                    }
                    
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-3 py-2">${student.name}</td>
                        <td class="px-3 py-2">${student.class}</td>
                        <td class="px-3 py-2"><span class="text-xs px-2 py-1 rounded-full ${statusClass}">${statusText}</span></td>
                        <td class="px-3 py-2">${scoreText}</td>
                        <td class="px-3 py-2">${actionButton}</td>
                    `;
                    
                    container.appendChild(row);
                });
            }
            
            document.getElementById('viewSubmissionsModal').classList.remove('hidden');
        }
        
        // Hide view submissions modal
        function hideViewSubmissionsModal() {
            document.getElementById('viewSubmissionsModal').classList.add('hidden');
        }
        
        // Show grade assignment modal
        function showGradeAssignmentModal(assignmentId, studentId) {
            const assignment = assignments.find(a => a.id === assignmentId);
            const student = students.find(s => s.id === studentId);
            const submission = submissions.find(s => s.assignmentId === assignmentId && s.studentId === studentId);
            
            if (!assignment || !student) return;
            
            document.getElementById('gradeAssignmentId').value = assignmentId;
            document.getElementById('gradeStudentId').value = studentId;
            document.getElementById('gradeAssignmentTitle').textContent = assignment.title;
            document.getElementById('gradeAssignmentStudent').textContent = `Siswa: ${student.name} (${student.class})`;
            document.getElementById('gradeAssignmentSubject').textContent = `Mata Pelajaran: ${assignment.subject}`;
            document.getElementById('gradeAssignmentDueDate').textContent = `Deadline: ${formatDate(assignment.dueDate)}`;
            document.getElementById('maxScore').textContent = assignment.maxScore;
            
            // Set file link if exists
            const fileLink = document.getElementById('gradeAssignmentFileLink');
            if (submission && submission.fileName) {
                fileLink.textContent = submission.fileName;
                fileLink.href = '#'; // In a real app, this would link to the actual file
                document.getElementById('gradeAssignmentSubmission').classList.remove('hidden');
            } else {
                document.getElementById('gradeAssignmentSubmission').classList.add('hidden');
            }
            
            // Set current score and feedback if exists
            document.getElementById('assignmentScore').value = submission && submission.score !== undefined ? submission.score : '';
            document.getElementById('assignmentFeedback').value = submission && submission.feedback ? submission.feedback : '';
            
            document.getElementById('gradeAssignmentModal').classList.remove('hidden');
        }
        
        // Hide grade assignment modal
        function hideGradeAssignmentModal() {
            document.getElementById('gradeAssignmentModal').classList.add('hidden');
        }
        
        // Grade assignment
        function gradeAssignment(event) {
            event.preventDefault();
            
            const assignmentId = document.getElementById('gradeAssignmentId').value;
            const studentId = document.getElementById('gradeStudentId').value;
            const score = parseInt(document.getElementById('assignmentScore').value);
            const feedback = document.getElementById('assignmentFeedback').value;
            
            const assignment = assignments.find(a => a.id === assignmentId);
            if (!assignment) return;
            
            if (score > assignment.maxScore) {
                showNotification(`Nilai tidak boleh lebih dari ${assignment.maxScore}!`, 'error');
                return;
            }
            
            // Find or create submission
            let submission = submissions.find(s => s.assignmentId === assignmentId && s.studentId === studentId);
            
            if (submission) {
                // Update existing submission
                submission.score = score;
                submission.feedback = feedback;
                submission.gradedAt = new Date().toISOString();
                submission.gradedBy = currentUser.id;
            } else {
                // Create new submission (shouldn't happen normally)
                submission = {
                    id: generateId(),
                    assignmentId: assignmentId,
                    studentId: studentId,
                    score: score,
                    feedback: feedback,
                    gradedAt: new Date().toISOString(),
                    gradedBy: currentUser.id
                };
                submissions.push(submission);
            }
            
            localStorage.setItem('submissions', JSON.stringify(submissions));
            
            showNotification('Nilai berhasil disimpan!', 'success');
            hideGradeAssignmentModal();
            
            // Reload admin data
            loadAdminData();
            updateQuickStats();
        }
        
        // Show edit profile modal
        function showEditProfileModal() {
            document.getElementById('profileName').value = currentUser.name;
            document.getElementById('profileUsername').value = currentUser.username;
            
            if (currentUser.role === 'student') {
                document.getElementById('studentFields').classList.remove('hidden');
                document.getElementById('profileClass').value = currentUser.class;
            } else {
                document.getElementById('studentFields').classList.add('hidden');
            }
            
            document.getElementById('newPassword').value = '';
            
            document.getElementById('editProfileModal').classList.remove('hidden');
        }
        
        // Hide edit profile modal
        function hideEditProfileModal() {
            document.getElementById('editProfileModal').classList.add('hidden');
        }
        
        // Update profile
        function updateProfile(event) {
            event.preventDefault();
            
            const name = document.getElementById('profileName').value;
            const newPassword = document.getElementById('newPassword').value;
            
            // Update current user
            currentUser.name = name;
            
            if (currentUser.role === 'student') {
                currentUser.class = document.getElementById('profileClass').value;
                
                // Update in students array
                const studentIndex = students.findIndex(s => s.id === currentUser.id);
                if (studentIndex !== -1) {
                    students[studentIndex].name = name;
                    students[studentIndex].class = currentUser.class;
                    
                    if (newPassword) {
                        students[studentIndex].password = newPassword;
                        currentUser.password = newPassword;
                    }
                    
                    localStorage.setItem('students', JSON.stringify(students));
                }
            } else {
                // Update in teachers array
                const teacherIndex = teachers.findIndex(t => t.id === currentUser.id);
                if (teacherIndex !== -1) {
                    teachers[teacherIndex].name = name;
                    
                    if (newPassword) {
                        teachers[teacherIndex].password = newPassword;
                        currentUser.password = newPassword;
                    }
                    
                    localStorage.setItem('teachers', JSON.stringify(teachers));
                }
            }
            
            // Save current user
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Update UI
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0);
            document.getElementById('userName').textContent = currentUser.name;
            
            if (currentUser.role === 'student') {
                document.getElementById('userInfo').textContent = `Kelas: ${currentUser.class}`;
            }
            
            showNotification('Profil berhasil diperbarui!', 'success');
            hideEditProfileModal();
        }
        
        // Show import students modal
        function showImportStudentsModal() {
            document.getElementById('importStudentsModal').classList.remove('hidden');
        }
        
        // Hide import students modal
        function hideImportStudentsModal() {
            document.getElementById('importStudentsModal').classList.add('hidden');
        }
        
        // Download template
        function downloadTemplate() {
            // In a real app, this would download an actual template file
            showNotification('Fitur download template akan segera hadir!', 'info');
        }
        
        // Process import
        function processImport() {
            // In a real app, this would process the uploaded file
            showNotification('Fitur import data akan segera hadir!', 'info');
        }
        
        // Show bulk grade modal
        function showBulkGradeModal() {
            showNotification('Fitur nilai massal akan segera hadir!', 'info');
        }
        
        // Export grades
        function exportGrades() {
            showNotification('Fitur ekspor nilai akan segera hadir!', 'info');
        }
        
        // Show send reminders modal
        function showSendRemindersModal() {
            showNotification('Fitur kirim pengingat akan segera hadir!', 'info');
        }
        
        // Edit assignment
        function editAssignment(assignmentId) {
            showNotification('Fitur edit tugas akan segera hadir!', 'info');
        }
        
        // Delete assignment
        function deleteAssignment(assignmentId) {
            if (confirm('Apakah Anda yakin ingin menghapus tugas ini?')) {
                assignments = assignments.filter(a => a.id !== assignmentId);
                localStorage.setItem('assignments', JSON.stringify(assignments));
                
                // Also remove related submissions
                submissions = submissions.filter(s => s.assignmentId !== assignmentId);
                localStorage.setItem('submissions', JSON.stringify(submissions));
                
                showNotification('Tugas berhasil dihapus!', 'success');
                
                // Reload admin data
                loadAdminData();
                updateQuickStats();
            }
        }
        
        // Logout
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            
            // Clear login form
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        }
        
        // Show notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }
        
        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Generate ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        // Handle file drop zone events
        function initFileDropZones() {
            const fileDropZones = document.querySelectorAll('.file-drop-zone');
            
            fileDropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('dragover');
                });
                
                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('dragover');
                });
                
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const fileInput = zone.querySelector('input[type="file"]');
                        if (fileInput) {
                            fileInput.files = files;
                            updateFilePreview(fileInput);
                        }
                    }
                });
            });
            
            // Handle file input changes
            const fileInputs = document.querySelectorAll('input[type="file"]');
            fileInputs.forEach(input => {
                input.addEventListener('change', () => {
                    updateFilePreview(input);
                });
            });
        }
        
        // Update file preview
        function updateFilePreview(fileInput) {
            const container = fileInput.closest('div');
            const preview = container.querySelector('[id$="FilePreview"]');
            const fileName = container.querySelector('[id$="FileName"]');
            
            if (fileInput.files && fileInput.files.length > 0) {
                const file = fileInput.files[0];
                fileName.textContent = file.name;
                preview.classList.remove('hidden');
            } else {
                preview.classList.add('hidden');
            }
        }
        
        // Remove file
        function removeAssignmentFile() {
            document.getElementById('assignmentFile').value = '';
            document.getElementById('assignmentFilePreview').classList.add('hidden');
        }
        
        function removeImportFile() {
            document.getElementById('importFile').value = '';
            document.getElementById('importFilePreview').classList.add('hidden');
        }
        
        function removeSubmissionFile() {
            document.getElementById('submissionFile').value = '';
            document.getElementById('submissionFilePreview').classList.add('hidden');
        }
        
        // Initialize the app when the page loads
        window.onload = function() {
            initApp();
            initFileDropZones();
        };
    </script>
</body>
</html>
