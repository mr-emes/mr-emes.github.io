<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emes Classroom - LMS Mobile</title>
    <link rel="icon" type="image/png" href="https://archive.org/download/logoms-1/logowarna.png">
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .safe-area { padding-bottom: 80px; }
        .nav-item.active { color: #3B82F6; }
        .nav-item.active svg { fill: #3B82F6; }
        .class-card { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .assignment-card { border-left: 4px solid #3B82F6; }
        .due-soon { border-left-color: #F59E0B; }
        .overdue { border-left-color: #EF4444; }
        
        /* Loading Animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 4px solid transparent;
            border-radius: 50%;
            background: linear-gradient(45deg, #10B981, #059669);
            animation: spin 1s linear infinite;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .loading-logo {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #initialLoading {
            transition: opacity 0.5s ease-out;
        }
        
        .login-container { min-height: 100vh; background: linear-gradient(135deg, #10B981 0%, #059669 100%); }
        .student-view .teacher-only { display: none !important; }
        .teacher-view .student-only { display: none !important; }
        
        /* Student specific styling */
        .student-view .nav-item:nth-child(4) { display: flex; }
        .teacher-view .nav-item:nth-child(4) { display: none; }
        
        /* Different header colors for roles */
        .student-view header { background: linear-gradient(135deg, #047857, #10B981); }
        .teacher-view header { background: linear-gradient(135deg, #1E40AF, #3B82F6); }
        .student-view header h1, .student-view header p { color: white; }
        .teacher-view header h1, .teacher-view header p { color: white; }
        .grade-badge { background: linear-gradient(135deg, #10B981, #047857); }
        
        /* Class Colors */
        .class-color-blue { background: linear-gradient(135deg, #3B82F6, #1E40AF); }
        .class-color-green { background: linear-gradient(135deg, #10B981, #047857); }
        .class-color-purple { background: linear-gradient(135deg, #8B5CF6, #5B21B6); }
        .class-color-red { background: linear-gradient(135deg, #EF4444, #B91C1C); }
        .class-color-yellow { background: linear-gradient(135deg, #F59E0B, #D97706); }
        .class-color-pink { background: linear-gradient(135deg, #EC4899, #BE185D); }
        .class-color-indigo { background: linear-gradient(135deg, #6366F1, #4338CA); }
        .class-color-teal { background: linear-gradient(135deg, #14B8A6, #0F766E); }
    </style>
</head>
<body class="bg-blue-50 font-sans" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 50%, #93c5fd 100%); min-height: 100vh;">

    <!-- Initial Loading Screen -->
    <div id="initialLoading" class="fixed inset-0 bg-gradient-to-br from-green-600 to-green-800 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="loading-spinner mb-6">
                <div class="loading-logo">
                    <img src="https://archive.org/download/logoms-1/logowarna.png" alt="Logo" class="w-6 h-6">
                </div>
            </div>
            <h1 class="text-white text-2xl font-bold mb-2">Emes Classroom</h1>
            <p class="text-white text-opacity-80 mb-4" id="initLoadingText">Menghubungkan ke database...</p>
            <div class="w-64 bg-white bg-opacity-20 rounded-full h-2">
                <div id="loadingProgress" class="bg-white h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="text-center">
            <div class="loading-spinner">
                <div class="loading-logo">
                    <img src="https://archive.org/download/logoms-1/logowarna.png" alt="Logo" class="w-6 h-6">
                </div>
            </div>
            <p class="text-white mt-4 font-medium" id="loadingText">Memuat...</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-container flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8">
            <div class="text-center mb-8">
                <div class="w-16 h-16 mx-auto mb-4">
                    <img src="https://archive.org/download/logoms-1/logowarna.png" alt="Emes Classroom" class="w-full h-full object-contain">
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">Emes Classroom</h1>
                <p class="text-gray-600">Masuk ke akun Anda</p>
            </div>
            
            <div class="space-y-4">
                <div class="space-y-3">
                    <label class="block text-sm font-medium text-gray-700">Pilih Role:</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                            <input type="radio" name="userRole" value="teacher" class="mr-3 text-blue-600 focus:ring-blue-500" onchange="enableProceedButton()">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                    <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <span class="font-medium text-gray-800">Guru</span>
                                    <p class="text-xs text-gray-500">Akses penuh untuk mengelola kelas dan tugas</p>
                                </div>
                            </div>
                        </label>
                        <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                            <input type="radio" name="userRole" value="student" class="mr-3 text-green-600 focus:ring-green-500" onchange="enableProceedButton()">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                    <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                    </svg>
                                </div>
                                <div>
                                    <span class="font-medium text-gray-800">Siswa</span>
                                    <p class="text-xs text-gray-500">Lihat tugas dan nilai kelas</p>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
                <button id="proceedButton" onclick="proceedToLogin()" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>
                    Lanjutkan
                </button>
            </div>
        </div>
    </div>

    <!-- Teacher Login Modal -->
    <div id="teacherLoginModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg w-full max-w-md p-6">
                <h3 class="text-lg font-semibold mb-4 text-center">Login Guru</h3>
                <form id="teacherLoginForm" onsubmit="handleTeacherLogin(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="teacherEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="guru@sekolah.com" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="teacherPassword" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Password" required>
                    </div>
                    <div class="flex space-x-3">
                        <button type="button" onclick="hideTeacherLogin()" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">Batal</button>
                        <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Masuk</button>
                    </div>
                </form>
                <p class="text-xs text-gray-500 mt-4 text-center">Demo: gunakan email apapun + password "guru123"</p>
            </div>
        </div>
    </div>

    <!-- Student Login Modal -->
    <div id="studentLoginModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg w-full max-w-md p-6">
                <h3 class="text-lg font-semibold mb-4 text-center">Login Siswa</h3>
                <form id="studentLoginForm" onsubmit="handleStudentLogin(event)">
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">NIS (Nomor Induk Siswa)</label>
                        <input type="text" id="studentNIS" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-center text-lg font-mono" placeholder="220060" maxlength="6" pattern="[0-9]{6}" required>
                        <p class="text-xs text-gray-500 mt-1">Masukkan 6 digit NIS</p>
                    </div>
                    <div class="flex space-x-3">
                        <button type="button" onclick="hideStudentLogin()" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">Batal</button>
                        <button type="submit" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Masuk</button>
                    </div>
                </form>
                <p class="text-xs text-gray-500 mt-4 text-center">Contoh NIS: 220060, 220061, 220062</p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b fixed top-0 w-full z-40">
            <div class="flex items-center justify-between px-4 py-3">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8">
                        <img src="https://archive.org/download/logoms-1/logoputih.png" alt="Emes Classroom" class="w-full h-full object-contain">
                    </div>
                    <div>
                        <h1 class="text-lg font-semibold text-white">Emes Classroom</h1>
                        <p class="text-xs text-white text-opacity-80" id="userRole"></p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button onclick="logout()" class="p-2 rounded-full hover:bg-white hover:bg-opacity-20" title="Keluar">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </button>
                    <div id="userAvatar" class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <span class="text-white text-sm font-medium" id="userInitial">U</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="pt-16 safe-area">
            <!-- Home View -->
            <div id="homeView" class="p-4">
                <!-- Welcome Card -->
                <div class="bg-white rounded-lg p-6 mb-4 class-card">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-green-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-xl font-bold" id="welcomeInitial">U</span>
                        </div>
                        <div>
                            <h2 class="text-xl font-semibold text-gray-800" id="welcomeName">Selamat Datang!</h2>
                            <p class="text-gray-600" id="welcomeRole">Role</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="bg-white rounded-lg p-4 class-card text-center">
                        <div class="text-2xl font-bold text-blue-600" id="totalClasses">0</div>
                        <div class="text-sm text-gray-600">Kelas</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 class-card text-center">
                        <div class="text-2xl font-bold text-green-600" id="totalAssignments">0</div>
                        <div class="text-sm text-gray-600">Tugas</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-lg p-4 mb-4 class-card">
                    <h3 class="text-lg font-semibold mb-3 text-gray-800">Aksi Cepat</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="showView('classes')" class="flex items-center space-x-2 p-3 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                            <span class="text-blue-600 font-medium">Lihat Kelas</span>
                        </button>
                        <button onclick="showView('assignments')" class="flex items-center space-x-2 p-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors">
                            <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"></path>
                            </svg>
                            <span class="text-green-600 font-medium">Lihat Tugas</span>
                        </button>
                        <button onclick="showView('grades')" class="student-only flex items-center space-x-2 p-3 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors">
                            <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                            </svg>
                            <span class="text-purple-600 font-medium">Nilai Saya</span>
                        </button>
                        <button onclick="showView('profile')" class="flex items-center space-x-2 p-3 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition-colors">
                            <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <span class="text-yellow-600 font-medium">Profil</span>
                        </button>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-lg p-4 class-card">
                    <h3 class="text-lg font-semibold mb-3 text-gray-800">Aktivitas Terbaru</h3>
                    <div id="recentActivity" class="space-y-3">
                        <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-800">Selamat datang di Emes Classroom!</p>
                                <p class="text-xs text-gray-500">Mulai jelajahi fitur-fitur yang tersedia</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Classes View -->
            <div id="classesView" class="p-4 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Kelas Saya</h2>
                </div>
                <div id="classesList" class="space-y-4">
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                        <p class="text-gray-500 mb-4">Belum ada kelas</p>
                        <p class="text-sm text-gray-400">Kelas akan muncul di sini setelah guru menambahkan Anda</p>
                    </div>
                </div>
            </div>

            <!-- Assignments View -->
            <div id="assignmentsView" class="p-4 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Tugas</h2>
                </div>
                <div id="assignmentsList" class="space-y-3">
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"></path>
                        </svg>
                        <p class="text-gray-500 mb-4">Belum ada tugas</p>
                        <p class="text-sm text-gray-400">Tugas dari kelas Anda akan muncul di sini</p>
                    </div>
                </div>
            </div>

            <!-- Grades View (Student Only) -->
            <div id="gradesView" class="p-4 hidden student-only">
                <div class="mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Nilai Saya</h2>
                    <p class="text-gray-600 text-sm">Lihat nilai dan feedback dari guru</p>
                </div>
                <div id="gradesList" class="space-y-4">
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                        </svg>
                        <p class="text-gray-500">Belum ada nilai</p>
                    </div>
                </div>
            </div>

            <!-- Profile View -->
            <div id="profileView" class="p-4 hidden">
                <div class="bg-white rounded-lg p-6 mb-4 class-card">
                    <div class="flex items-center space-x-4 mb-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-green-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-xl font-bold" id="profileInitial">U</span>
                        </div>
                        <div class="flex-1">
                            <h2 class="text-xl font-semibold text-gray-800" id="profileName">User Demo</h2>
                            <p class="text-gray-600" id="profileEmail">user@educlass.com</p>
                            <p class="text-sm text-gray-500" id="profileRole">Role</p>
                        </div>
                    </div>
                    
                    <!-- Profile Stats -->
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div class="p-3 bg-blue-50 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600" id="profileTotalClasses">0</div>
                            <div class="text-sm text-gray-600">Kelas</div>
                        </div>
                        <div class="p-3 bg-green-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-600" id="profileTotalAssignments">0</div>
                            <div class="text-sm text-gray-600">Tugas</div>
                        </div>
                    </div>
                </div>

                <div class="space-y-3">
                    <div class="bg-white p-4 rounded-lg class-card">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                <span class="text-gray-800">Informasi Profil</span>
                            </div>
                            <span class="text-sm text-gray-500">Demo Mode</span>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg class-card">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span class="text-gray-800">Pengaturan</span>
                            </div>
                            <span class="text-sm text-gray-500">Segera Hadir</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-30">
            <div class="flex justify-around py-2">
                <button onclick="showView('home')" class="nav-item active flex flex-col items-center py-2 px-3">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                    <span class="text-xs">Beranda</span>
                </button>
                <button onclick="showView('classes')" class="nav-item flex flex-col items-center py-2 px-3 text-gray-600">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z"/>
                    </svg>
                    <span class="text-xs">Kelas</span>
                </button>
                <button onclick="showView('assignments')" class="nav-item flex flex-col items-center py-2 px-3 text-gray-600">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                    </svg>
                    <span class="text-xs">Tugas</span>
                </button>
                <button onclick="showView('grades')" class="nav-item student-only flex flex-col items-center py-2 px-3 text-gray-600">
                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                    </svg>
                    <span class="text-xs">Nilai</span>
                </button>
                <button onclick="showView('profile')" class="nav-item flex flex-col items-center py-2 px-3 text-gray-600">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    <span class="text-xs">Profil</span>
                </button>
            </div>
        </nav>
    </div>

    <script>
        // Firebase Configuration - REAL DATABASE CONNECTION
        const firebaseConfig = {
            apiKey: "AIzaSyB9uRFQCtCMMQ8QGwh-eTIpnUi1OdSiM1Y",
            authDomain: "emesce-19557.firebaseapp.com",
            databaseURL: "https://emesce-19557-default-rtdb.firebaseio.com",
            projectId: "emesce-19557",
            storageBucket: "emesce-19557.firebasestorage.app",
            messagingSenderId: "730243929475",
            appId: "1:730243929475:web:16417853e9fe9ac35c12b6",
            measurementId: "G-CGNNSWFNQ7"
        };

        // Initialize Firebase
        let db, storage, auth;
        let isFirebaseConnected = false;
        
        // App State
        let currentUser = null;
        let userRole = null;
        let currentView = 'home';
        let classes = [];
        let assignments = [];
        let students = [];
        let grades = [];
        let submissions = [];

        // Firebase Initialization Functions
        async function initializeFirebase() {
            try {
                updateLoadingProgress(10, "Memuat Firebase...");
                
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                updateLoadingProgress(30, "Menghubungkan ke Firestore...");
                
                db = firebase.firestore();
                storage = firebase.storage();
                auth = firebase.auth();
                
                updateLoadingProgress(50, "Mengautentikasi...");
                
                // Enable anonymous authentication
                await auth.signInAnonymously();
                
                updateLoadingProgress(70, "Menguji koneksi database...");
                
                // Test database connection
                await db.collection('students').limit(1).get();
                
                updateLoadingProgress(90, "Memuat data...");
                
                // Load initial data
                await loadInitialData();
                
                isFirebaseConnected = true;
                updateLoadingProgress(100, "Siap digunakan!");
                
                console.log("✅ Firebase connected successfully!");
                return true;
                
            } catch (error) {
                console.error("❌ Firebase connection failed:", error);
                updateLoadingProgress(100, "Mode offline - menggunakan data demo");
                isFirebaseConnected = false;
                loadDemoData();
                return false;
            }
        }

        function updateLoadingProgress(percent, text) {
            document.getElementById('loadingProgress').style.width = percent + '%';
            document.getElementById('initLoadingText').textContent = text;
        }

        async function loadInitialData() {
            try {
                // Load students
                const studentsSnapshot = await db.collection('students').get();
                students = studentsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // Load classes
                const classesSnapshot = await db.collection('classes').get();
                classes = classesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // Load assignments
                const assignmentsSnapshot = await db.collection('assignments').get();
                assignments = assignmentsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // Load grades
                const gradesSnapshot = await db.collection('grades').get();
                grades = gradesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                console.log(`Loaded: ${students.length} students, ${classes.length} classes, ${assignments.length} assignments`);
                
                // If no data exists, create demo data
                if (students.length === 0) {
                    await createDemoDataInFirebase();
                }
                
            } catch (error) {
                console.error("Error loading data:", error);
                loadDemoData();
            }
        }

        async function createDemoDataInFirebase() {
            try {
                console.log("Creating demo data in Firebase...");
                
                // Create demo students
                const demoStudents = [
                    { nis: '220060', name: 'Ahmad Rizki', class: '4A', createdAt: new Date().toISOString() },
                    { nis: '220061', name: 'Siti Nurhaliza', class: '4A', createdAt: new Date().toISOString() },
                    { nis: '220062', name: 'Budi Santoso', class: '4B', createdAt: new Date().toISOString() },
                    { nis: '220063', name: 'Dewi Sartika', class: '5A', createdAt: new Date().toISOString() },
                    { nis: '220064', name: 'Eko Prasetyo', class: '5B', createdAt: new Date().toISOString() }
                ];
                
                for (const student of demoStudents) {
                    await db.collection('students').add(student);
                }
                
                // Create demo classes
                const demoClasses = [
                    { 
                        name: 'Al-Quran Hadits 4A', 
                        subject: 'Al-Quran Hadits', 
                        grade: '4A', 
                        code: 'AQH4A001',
                        description: 'Pembelajaran Al-Quran dan Hadits untuk kelas 4A',
                        createdAt: new Date().toISOString()
                    },
                    { 
                        name: 'Fikih 4B', 
                        subject: 'Fikih', 
                        grade: '4B', 
                        code: 'FIQ4B001',
                        description: 'Pembelajaran Fikih untuk kelas 4B',
                        createdAt: new Date().toISOString()
                    }
                ];
                
                for (const cls of demoClasses) {
                    await db.collection('classes').add(cls);
                }
                
                console.log("Demo data created successfully!");
                
                // Reload data
                await loadInitialData();
                
            } catch (error) {
                console.error("Error creating demo data:", error);
                loadDemoData();
            }
        }

        function loadDemoData() {
            // Fallback demo data
            students = [
                { id: '1', nis: '220060', name: 'Ahmad Rizki', class: '4A' },
                { id: '2', nis: '220061', name: 'Siti Nurhaliza', class: '4A' },
                { id: '3', nis: '220062', name: 'Budi Santoso', class: '4B' },
                { id: '4', nis: '220063', name: 'Dewi Sartika', class: '5A' },
                { id: '5', nis: '220064', name: 'Eko Prasetyo', class: '5B' }
            ];
            
            classes = [
                { 
                    id: '1',
                    name: 'Al-Quran Hadits 4A', 
                    subject: 'Al-Quran Hadits', 
                    grade: '4A', 
                    code: 'AQH4A001',
                    description: 'Pembelajaran Al-Quran dan Hadits untuk kelas 4A',
                    createdAt: new Date().toISOString()
                }
            ];
            
            assignments = [];
            grades = [];
        }

        // Database Functions
        async function saveToFirestore(collection, data) {
            if (!isFirebaseConnected) {
                console.log('Firebase not connected, data not saved');
                return data.id || Date.now().toString();
            }

            try {
                if (data.id) {
                    await db.collection(collection).doc(data.id).set(data);
                    return data.id;
                } else {
                    const docRef = await db.collection(collection).add(data);
                    return docRef.id;
                }
            } catch (error) {
                console.error('Firestore save failed:', error);
                return data.id || Date.now().toString();
            }
        }

        async function loadFromFirestore(collection) {
            if (!isFirebaseConnected) {
                console.log('Firebase not connected, returning empty array');
                return [];
            }

            try {
                const snapshot = await db.collection(collection).get();
                return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            } catch (error) {
                console.error('Firestore load failed:', error);
                return [];
            }
        }

        // Loading Functions
        function showLoading(text = 'Memuat...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        // Login Functions
        function enableProceedButton() {
            const selectedRole = document.querySelector('input[name="userRole"]:checked');
            document.getElementById('proceedButton').disabled = !selectedRole;
        }

        function proceedToLogin() {
            const selectedRole = document.querySelector('input[name="userRole"]:checked');
            if (!selectedRole) {
                alert('Silakan pilih role terlebih dahulu');
                return;
            }
            
            if (selectedRole.value === 'teacher') {
                showTeacherLogin();
            } else {
                showStudentLogin();
            }
        }

        function showTeacherLogin() {
            document.getElementById('teacherLoginModal').classList.remove('hidden');
        }

        function hideTeacherLogin() {
            document.getElementById('teacherLoginModal').classList.add('hidden');
        }

        function showStudentLogin() {
            document.getElementById('studentLoginModal').classList.remove('hidden');
        }

        function hideStudentLogin() {
            document.getElementById('studentLoginModal').classList.add('hidden');
        }

        async function handleTeacherLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('teacherEmail').value;
            const password = document.getElementById('teacherPassword').value;
            
            // Demo validation
            if (password !== 'guru123') {
                alert('Password salah! Gunakan "guru123" untuk demo');
                return;
            }
            
            showLoading('Login sebagai guru...');
            
            // Simulate loading
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const userData = {
                name: email.split('@')[0].replace(/[^a-zA-Z]/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                email: email,
                role: 'teacher'
            };
            
            hideTeacherLogin();
            hideLoading();
            login('teacher', userData);
        }

        async function handleStudentLogin(event) {
            event.preventDefault();
            
            const nis = document.getElementById('studentNIS').value;
            
            // Validate NIS format (6 digits)
            if (!/^\d{6}$/.test(nis)) {
                alert('NIS harus 6 digit angka!');
                return;
            }
            
            // Find student in database
            const student = students.find(s => s.nis === nis);
            if (!student) {
                alert('NIS tidak ditemukan! Coba: 220060, 220061, 220062, 220063, atau 220064');
                return;
            }
            
            showLoading('Login sebagai siswa...');
            
            // Simulate loading
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const userData = {
                nis: student.nis,
                name: student.name,
                class: student.class,
                role: 'student'
            };
            
            hideStudentLogin();
            hideLoading();
            login('student', userData);
        }

        function login(role, userData) {
            currentUser = userData;
            userRole = role;
            
            // Update UI based on role
            document.body.className = role === 'student' ? 'bg-blue-50 font-sans student-view' : 'bg-blue-50 font-sans teacher-view';
            document.body.style.background = 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 50%, #93c5fd 100%)';
            document.body.style.minHeight = '100vh';
            
            // Update header
            document.getElementById('userRole').textContent = role === 'teacher' ? 
                `Guru - ${userData.name}` : 
                `Siswa - ${userData.name} (${userData.class})`;
            document.getElementById('userInitial').textContent = userData.name.charAt(0).toUpperCase();
            
            // Update welcome section
            document.getElementById('welcomeInitial').textContent = userData.name.charAt(0).toUpperCase();
            document.getElementById('welcomeName').textContent = `Selamat Datang, ${userData.name}!`;
            document.getElementById('welcomeRole').textContent = role === 'teacher' ? 'Guru' : `Siswa Kelas ${userData.class}`;
            
            // Update profile section
            document.getElementById('profileInitial').textContent = userData.name.charAt(0).toUpperCase();
            document.getElementById('profileName').textContent = userData.name;
            document.getElementById('profileEmail').textContent = userData.email || `${userData.nis}@student.emes.sch.id`;
            document.getElementById('profileRole').textContent = role === 'teacher' ? 'Guru' : `Siswa - ${userData.class}`;
            
            // Show main app
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Load initial data
            loadHomeData();
        }

        function logout() {
            currentUser = null;
            userRole = null;
            
            // Reset UI
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.body.className = 'bg-blue-50 font-sans';
            document.body.style.background = 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 50%, #93c5fd 100%)';
            document.body.style.minHeight = '100vh';
            
            // Reset forms
            document.querySelectorAll('input[name="userRole"]').forEach(radio => radio.checked = false);
            document.getElementById('proceedButton').disabled = true;
            document.getElementById('teacherEmail').value = '';
            document.getElementById('teacherPassword').value = '';
            document.getElementById('studentNIS').value = '';
            
            // Reset to home view
            showView('home');
        }

        // Navigation
        function showView(view) {
            // Hide all views
            document.querySelectorAll('[id$="View"]').forEach(v => v.classList.add('hidden'));
            
            // Show selected view
            document.getElementById(view + 'View').classList.remove('hidden');
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                item.classList.add('text-gray-600');
            });
            
            // Find and activate the clicked nav item
            const clickedItem = event ? event.target.closest('.nav-item') : document.querySelector('.nav-item');
            if (clickedItem) {
                clickedItem.classList.add('active');
                clickedItem.classList.remove('text-gray-600');
            }
            
            currentView = view;
            
            // Load view data
            if (view === 'home') loadHomeData();
            else if (view === 'classes') loadClasses();
            else if (view === 'assignments') loadAssignments();
            else if (view === 'grades') loadGrades();
            else if (view === 'profile') loadProfile();
        }

        // Data Loading Functions
        function loadHomeData() {
            // Update stats with real data
            document.getElementById('totalClasses').textContent = classes.length;
            document.getElementById('totalAssignments').textContent = assignments.length;
            document.getElementById('profileTotalClasses').textContent = classes.length;
            document.getElementById('profileTotalAssignments').textContent = assignments.length;
            
            // Show database connection status
            const statusText = isFirebaseConnected ? 
                `🟢 Terhubung ke Firebase (${students.length} siswa)` : 
                '🔴 Mode Offline';
            
            // Add connection status to recent activity
            const recentActivity = document.getElementById('recentActivity');
            if (recentActivity && !recentActivity.querySelector('.db-status')) {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'db-status flex items-center space-x-3 p-3 bg-gray-50 rounded-lg';
                statusDiv.innerHTML = `
                    <div class="w-8 h-8 ${isFirebaseConnected ? 'bg-green-100' : 'bg-red-100'} rounded-full flex items-center justify-center">
                        <svg class="w-4 h-4 ${isFirebaseConnected ? 'text-green-600' : 'text-red-600'}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"></path>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-800">Status Database</p>
                        <p class="text-xs text-gray-500">${statusText}</p>
                    </div>
                `;
                recentActivity.insertBefore(statusDiv, recentActivity.firstChild);
            }
        }

        function loadClasses() {
            const container = document.getElementById('classesList');
            
            if (classes.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                        <p class="text-gray-500 mb-4">Belum ada kelas</p>
                        <p class="text-sm text-gray-400">${isFirebaseConnected ? 'Data akan dimuat dari Firebase' : 'Mode offline - data terbatas'}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = classes.map((cls, index) => {
                const colorClass = `class-color-${['blue', 'green', 'purple', 'red', 'yellow', 'pink', 'indigo', 'teal'][index % 8]}`;
                return `
                    <div class="rounded-lg overflow-hidden class-card">
                        <div class="${colorClass} p-4 text-white">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-lg font-semibold">${cls.name}</h3>
                                <span class="text-xs bg-white bg-opacity-20 px-2 py-1 rounded-full">${cls.code}</span>
                            </div>
                            <p class="text-white text-opacity-90 text-sm">${cls.description || 'Tidak ada deskripsi'}</p>
                        </div>
                        <div class="bg-white p-4">
                            <div class="flex justify-between items-center text-sm text-gray-500">
                                <span>Kelas: ${cls.grade}</span>
                                <span>Mata Pelajaran: ${cls.subject}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadAssignments() {
            const container = document.getElementById('assignmentsList');
            
            if (assignments.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"></path>
                        </svg>
                        <p class="text-gray-500 mb-4">Belum ada tugas</p>
                        <p class="text-sm text-gray-400">${isFirebaseConnected ? 'Tugas akan muncul setelah guru membuatnya' : 'Mode offline - data terbatas'}</p>
                    </div>
                `;
                return;
            }

            // Display assignments (implementation would be similar to classes)
            container.innerHTML = assignments.map(assignment => `
                <div class="bg-white rounded-lg p-4 assignment-card">
                    <h3 class="text-lg font-semibold text-gray-800">${assignment.title}</h3>
                    <p class="text-gray-600 text-sm">${assignment.description}</p>
                </div>
            `).join('');
        }

        function loadGrades() {
            const container = document.getElementById('gradesList');
            
            if (grades.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                        </svg>
                        <p class="text-gray-500">Belum ada nilai</p>
                        <p class="text-sm text-gray-400">${isFirebaseConnected ? 'Nilai akan muncul setelah guru menilai tugas' : 'Mode offline - data terbatas'}</p>
                    </div>
                `;
                return;
            }
        }

        function loadProfile() {
            // Profile data already loaded in login function
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize Firebase and load data
            await initializeFirebase();
            
            // Hide initial loading screen after 1 second
            setTimeout(() => {
                document.getElementById('initialLoading').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('initialLoading').style.display = 'none';
                }, 500);
            }, 1000);
            
            // Set initial view
            showView('home');
            
            // Add NIS input formatting
            const nisInput = document.getElementById('studentNIS');
            if (nisInput) {
                nisInput.addEventListener('input', function(e) {
                    // Only allow numbers
                    e.target.value = e.target.value.replace(/[^0-9]/g, '');
                });
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97ad3be61161f93e',t:'MTc1NzE1NDAyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
